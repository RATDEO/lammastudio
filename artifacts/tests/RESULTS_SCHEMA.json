{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Model Validation Results Schema",
  "description": "Schema for vLLM Studio model validation test results",
  "type": "object",
  "required": [
    "model_id",
    "timestamp",
    "controller_url",
    "inference_url",
    "tests",
    "overall_passed"
  ],
  "properties": {
    "model_id": {
      "type": "string",
      "description": "Identifier of the model being tested (e.g., model name or recipe ID)"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of when the validation was performed"
    },
    "controller_url": {
      "type": "string",
      "format": "uri",
      "description": "URL of the vLLM Studio controller API"
    },
    "inference_url": {
      "type": "string",
      "format": "uri",
      "description": "URL of the inference backend (vLLM/SGLang)"
    },
    "tests": {
      "type": "object",
      "description": "Results for each individual test",
      "properties": {
        "health_check": {
          "$ref": "#/definitions/test_result",
          "description": "Validates controller and inference backend health endpoints"
        },
        "short_generation": {
          "$ref": "#/definitions/test_result",
          "description": "Validates short text generation performance and latency"
        },
        "long_context": {
          "$ref": "#/definitions/test_result",
          "description": "Validates ability to process near-full context window"
        },
        "memory_headroom": {
          "$ref": "#/definitions/test_result",
          "description": "Validates VRAM usage stays within acceptable limits"
        },
        "restart_validation": {
          "$ref": "#/definitions/test_result",
          "description": "Validates model can be evicted and relaunched successfully"
        }
      }
    },
    "overall_passed": {
      "type": "boolean",
      "description": "True if all tests passed, false if any test failed"
    },
    "notes": {
      "type": "string",
      "description": "Additional notes or observations about the validation"
    }
  },
  "definitions": {
    "test_result": {
      "type": "object",
      "required": ["passed"],
      "properties": {
        "passed": {
          "type": "boolean",
          "description": "Whether the test passed or failed"
        },
        "latency_ms": {
          "type": ["number", "null"],
          "description": "Test execution time in milliseconds"
        },
        "error": {
          "type": ["string", "null"],
          "description": "Error message if test failed"
        },
        "details": {
          "type": "object",
          "description": "Test-specific details and measurements",
          "additionalProperties": true
        }
      }
    }
  },
  "examples": [
    {
      "model_id": "Qwen2.5-72B-Instruct-AWQ",
      "timestamp": "2025-12-20T13:30:45.123456Z",
      "controller_url": "http://localhost:8080",
      "inference_url": "http://localhost:8000",
      "tests": {
        "health_check": {
          "passed": true,
          "latency_ms": 42.5,
          "error": null,
          "details": {
            "controller_status": {
              "status": "ok",
              "version": "0.2.0",
              "inference_ready": true
            },
            "inference_ready": true
          }
        },
        "short_generation": {
          "passed": true,
          "latency_ms": 1250.3,
          "error": null,
          "details": {
            "tokens_generated": 128,
            "generated_text_length": 487,
            "threshold_ms": 5000
          }
        },
        "long_context": {
          "passed": true,
          "latency_ms": 45800.7,
          "error": null,
          "details": {
            "max_model_len": 32768,
            "target_context": 29491,
            "target_ratio": 0.9,
            "prompt_tokens_achieved": 29234,
            "achieved_ratio": 0.892,
            "min_acceptable_ratio": 0.72
          }
        },
        "memory_headroom": {
          "passed": true,
          "latency_ms": 15.2,
          "error": null,
          "details": {
            "gpus": [
              {
                "gpu_index": 0,
                "gpu_name": "NVIDIA RTX 4090",
                "memory_total_gb": 24.0,
                "memory_used_gb": 21.2,
                "usage_percent": 88.3,
                "max_acceptable_usage": 95.0,
                "passed": true
              }
            ]
          }
        },
        "restart_validation": {
          "passed": true,
          "latency_ms": 125400.1,
          "error": null,
          "details": {
            "recipe_id": "qwen-72b-awq",
            "restart_time_ms": 125400.1,
            "verification_passed": true
          }
        }
      },
      "overall_passed": true,
      "notes": "All tests passed. Model is ready for production deployment."
    },
    {
      "model_id": "experimental-model",
      "timestamp": "2025-12-20T14:15:22.987654Z",
      "controller_url": "http://localhost:8080",
      "inference_url": "http://localhost:8000",
      "tests": {
        "health_check": {
          "passed": true,
          "latency_ms": 38.1,
          "error": null,
          "details": {}
        },
        "short_generation": {
          "passed": false,
          "latency_ms": 6200.5,
          "error": null,
          "details": {
            "tokens_generated": 95,
            "generated_text_length": 320,
            "threshold_ms": 5000
          }
        },
        "long_context": {
          "passed": false,
          "latency_ms": 1200.3,
          "error": "Long context generation failed: 500",
          "details": {}
        },
        "memory_headroom": {
          "passed": false,
          "latency_ms": 18.7,
          "error": null,
          "details": {
            "gpus": [
              {
                "gpu_index": 0,
                "gpu_name": "NVIDIA RTX 4090",
                "memory_total_gb": 24.0,
                "memory_used_gb": 23.1,
                "usage_percent": 96.3,
                "max_acceptable_usage": 95.0,
                "passed": false
              }
            ]
          }
        }
      },
      "overall_passed": false,
      "notes": "Failed latency and memory tests. Consider reducing max_model_len or increasing gpu_memory_utilization headroom."
    }
  ]
}
